{# Frontend/templates/calculators/house_affordability/_custom_calculator.html #}
{% from "macros/input_combo.html" import input_combo %}

<div class="flex flex-col lg:flex-row lg:space-x-12">

    <!-- LEFT COLUMN -->
    <div class="flex-1">

        <form
            method="POST"
            hx-post="{{ url_for('calculators.house_affordability_custom') }}"
            hx-target="#custom-results"
            hx-swap="innerHTML"
            id="custom-form"
            class="space-y-6 max-w-lg"
        >

            <!-- INCOME -->
            {{ input_combo(
                name="income",
                label="Annual Gross Household Income",
                prefix="$",
                placeholder="0",
                classes="money-input",
                required=True
            ) }}

            <!-- DOWN PAYMENT SECTION -->
            <div class="space-y-2">

                <div class="flex items-center space-x-2">
                    <label class="font-semibold">Down Payment</label>

                    <div 
                        class="tooltip-icon"
                        data-tooltip="Adjust your down payment. In % mode, this is a percentage of the home price. In $ mode, it is a percentage of your maximum down payment."
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" 
                             class="h-4 w-4 text-gray-500" 
                             fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <circle cx="12" cy="12" r="10" stroke-width="2"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 16v-4m0-4h.01"/>
                        </svg>
                    </div>
                </div>

                <!-- MODE TOGGLE -->
                <div class="flex items-center space-x-4">
                    <span class="text-sm">Mode:</span>

                    <label class="cursor-pointer flex items-center space-x-1">
                        <input type="radio" name="dp_mode" value="dollar" checked>
                        <span>$</span>
                    </label>

                    <label class="cursor-pointer flex items-center space-x-1">
                        <input type="radio" name="dp_mode" value="percent">
                        <span>%</span>
                    </label>
                </div>

                <!-- SLIDER LABELS -->
                <div class="flex justify-between text-sm text-gray-600">
                    <span id="dp-min-label">0%</span>
                    <span id="dp-max-label">100%</span>
                </div>

                <!-- SLIDER WRAPPER -->
                <div class="relative w-full mt-2">

                    <input
                        type="range"
                        name="down_payment_slider"
                        id="down_payment_slider"
                        min="0"
                        max="100"
                        value="20"
                        class="w-full appearance-none h-2 bg-gray-300 dark:bg-gray-700 rounded-lg cursor-pointer"
                    >

                    <!-- Label inside knob, initially positioned to match default slider value -->
                    <div
                        id="dp-slider-label"
                        class="absolute top-1/2 -translate-y-1/2 
                               px-2 py-0.5 text-xs font-semibold
                               bg-blue-600 dark:bg-blue-500 
                               text-white rounded-full pointer-events-none
                               transition-all duration-75"
                        style="left: calc(20% - 16px);"
                    >
                        20%
                    </div>
                </div>

                <!-- MAX VALUE FOR $ MODE -->
                <div id="dp-max-row" class="flex items-center space-x-2">
                    <label>Max $:</label>
                    <input
                        type="number"
                        name="down_payment_max"
                        id="down_payment_max"
                        class="border rounded px-2 py-1 w-32 
                               bg-white dark:bg-gray-800 
                               text-gray-900 dark:text-gray-100 
                               border-gray-300 dark:border-gray-600"
                        value="200000"
                    >
                </div>

            </div>

            <!-- PERCENTAGE OF MONTHLY INCOME -->
            <div class="space-y-2">

                <div class="flex items-center space-x-2">
                    <label class="font-semibold">Percentage of Monthly Income</label>

                    <div 
                        class="tooltip-icon"
                        data-tooltip="Your total monthly housing cost cannot exceed this percentage of your income."
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" 
                             class="h-4 w-4 text-gray-500" 
                             fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <circle cx="12" cy="12" r="10" stroke-width="2"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 16v-4m0-4h.01"/>
                        </svg>
                    </div>
                </div>

                <div class="relative w-full mt-2">

                    <input
                        type="range"
                        name="income_pct_slider"
                        id="income_pct_slider"
                        min="0"
                        max="25"
                        value="25"
                        class="w-full appearance-none h-2 bg-gray-300 dark:bg-gray-700 rounded-lg cursor-pointer"
                    >

                    <!-- Label inside knob, initially positioned to match default slider value -->
                    <div
                        id="income-pct-label"
                        class="absolute top-1/2 -translate-y-1/2 
                               px-2 py-0.5 text-xs font-semibold
                               bg-blue-600 dark:bg-blue-500 
                               text-white rounded-full pointer-events-none
                               transition-all duration-75"
                        style="left: calc(100% - 16px);"
                    >
                        25%
                    </div>
                </div>

                <div class="flex justify-between text-sm text-gray-600">
                    <span>0%</span>
                    <span>25%</span>
                </div>
            </div>

            <!-- INTEREST RATE -->
            {{ input_combo(
                name="interest_rate",
                label="Interest Rate",
                suffix="%",
                placeholder="0",
                classes="percent-input",
                required=True
            ) }}

            <!-- LOAN TERM -->
            {{ input_combo(
                name="loan_term",
                label="Loan Term (years)",
                suffix="years",
                placeholder="30",
                classes="numeric-input",
                required=True
            ) }}

            <!-- ADVANCED OPTIONS -->
            <input type="hidden" id="custom-advanced-state" name="custom_advanced_state" value="0">

            <button
                type="button"
                class="mt-2 px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded"
                hx-get="{{ url_for('calculators.house_affordability_custom_advanced') }}"
                hx-vals='js:{"show": document.getElementById("custom-advanced-state").value === "0" ? "1" : "0"}'
                hx-target="#custom-advanced-fields"
                hx-swap="innerHTML"
                hx-on::after-request="document.getElementById('custom-advanced-state').value = document.getElementById('custom-advanced-state').value === '0' ? '1' : '0';"
            >
                Advanced Options
            </button>

            <div id="custom-advanced-fields" class="mt-4"></div>

            <!-- CALCULATE BUTTON -->
            <button type="submit" class="mt-6 px-4 py-2 bg-blue-600 text-white rounded">
                Calculate
            </button>

        </form>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="flex-1 mt-8 lg:mt-0" id="custom-results"></div>

</div>

<script src="{{ url_for('static', filename='js/custom_calculator.js') }}"></script>
